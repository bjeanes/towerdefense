<html>
  <head>
    <%= stylesheet_link_tag :all %>
    <%= javascript_include_tag :defaults, :juggernaut, 'chat' %>
    <%= juggernaut \
          :host => request.host, 
          :client_id => current_user.id,
          :channels => [@game.id] %>
    <title>Tower Defense Game: <%= @game.name %></title>
  </head>
  <body id="game">
    <div id="swf">
      <object codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" width="75%" height="500"
        classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" id="index" align="middle">
      	<param name="allowScriptAccess" value="sameDomain" />
      	<param name="allowFullScreen" value="false" />
      	<param name="movie" value="/index.swf" />
      	<param name="quality" value="high" />
      	<param name="bgcolor" value="#000000" />
      	<embed src="/index.swf" quality="high" bgcolor="#000000" width="75%" height="500"
      	  name="index" align="middle" allowScriptAccess="sameDomain" allowFullScreen="false" 
      	  type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" />
    	</object>
    </div>
    <div id="chat">
      <div id="messages">
        <div class="history">
          <%= render :partial => 'messages/message', :collection => @messages %>
          <div class="marker">
            &#x21E7; HISTORY &#x21E7;
          </div>
        </div>
      </div>
      <div id="text_input">
        <form method="post" action="<%= messages_path %>" id="send_message_form">
          <%= text_field_tag 'message[content]', '', 
              { :id => 'message_content', 
                :disabled => true} %>
          <%= hidden_field_tag 'message[kind]', 'channel', {:id => 'message_kind'}%>
          <%= hidden_field_tag 'message[channel_id]', @game.id, { :id => 'message_channel' } %>
          <%= hidden_field_tag 'authenticity_token', form_authenticity_token %>
          <%= submit_tag "Send", {:id => "message_send", :disabled => true} %>
        </form>
        
        <div id="chat_status">
          Disconnected.
        </div>
      </div>
    </div>
    <div id="users">
      <%= render :partial => 'shared/user_list', :locals => {:users => User.online} %>
    </div>
  </body>
</html>